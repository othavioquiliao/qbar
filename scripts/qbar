#!/usr/bin/env bash
# qbar - LLM quota monitor for Waybar
# 
# Commands:
#   (none)          - Output JSON for Waybar module
#   menu            - Open interactive TUI
#   refresh         - Force refresh with terminal spinner
#   refresh-waybar  - Force refresh with waybar spinner animation
#   status          - Terminal output

SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
cd "$SCRIPT_DIR/.." || exit 1

case "${1:-}" in
  menu)
    # Interactive TUI with @clack/prompts
    exec bun src/menu.ts
    ;;
  setup)
    # Automated Waybar configuration
    exec bun src/setup.ts
    ;;
  uninstall)
    # Remove all qbar files from system
    exec bun src/uninstall.ts
    ;;
  update)
    # Update qbar to latest version
    exec bun src/update.ts
    ;;
  refresh)
    # Force refresh with ora spinner (terminal)
    shift
    exec bun src/refresh.ts "$@"
    ;;
  action-right)
    # Waybar right-click: login if disconnected, else refresh
    shift
    exec bun src/action-right.ts "$@"
    ;;
  status)
    # Terminal output
    exec bun src/index.ts --command terminal
    ;;
  *)
    # Default: Waybar JSON output
    exec bun src/index.ts "$@"
    ;;
esac
