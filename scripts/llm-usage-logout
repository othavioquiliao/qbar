#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
export PATH="$HOME/.local/share/omarchy/bin:$PATH"
MENU_BIN="omarchy-launch-walker"

has_claude() {
  [ -f "$HOME/.claude/.credentials.json" ]
}

has_codex() {
  [ -f "$HOME/.codex/auth.json" ] || [ -d "$HOME/.codex" ]
}

has_antigravity() {
  [ -d "$HOME/.config/antigravity-usage/accounts" ] && ls -1 "$HOME/.config/antigravity-usage/accounts" >/dev/null 2>&1
}

options=""
if has_claude; then options+=$'Claude\n'; fi
if has_codex; then options+=$'Codex\n'; fi
if has_antigravity; then options+=$'Antigravity\n'; fi

if [ -z "$options" ]; then
  echo "No providers currently logged in."
  exit 0
fi

choice=$(echo -e "$options" | $MENU_BIN --dmenu --width 260 --minheight 1 --maxheight 300 -p "Logout" 2>/dev/null || true)

case "$choice" in
  Claude)
    "$SCRIPT_DIR/logout/claude.sh" ;;
  Codex)
    "$SCRIPT_DIR/logout/codex.sh" ;;
  Antigravity)
    "$SCRIPT_DIR/logout/antigravity.sh" ;;
  *)
    exit 0 ;;
esac
