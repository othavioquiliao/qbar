#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
export PATH="$HOME/.local/share/omarchy/bin:$PATH"
MENU_BIN="omarchy-launch-walker"

if ! command -v "$MENU_BIN" >/dev/null 2>&1; then
  echo "omarchy-launch-walker not found" >&2
  exit 1
fi

OPTIONS=$(cat <<'EOF'
Show Details
Claude Login
Antigravity Cloud Login
Reload Waybar
EOF
)

choice=$(echo "$OPTIONS" | $MENU_BIN --dmenu --width 260 --minheight 1 --maxheight 300 -p "LLM Usage" 2>/dev/null || true)

case "$choice" in
  "Show Details")
    omarchy-launch-floating-terminal-with-presentation "$SCRIPT_DIR/waybar-llm-usage.sh && echo && read -p 'Press Enter...'" ;;
  "Claude Login")
    omarchy-launch-floating-terminal-with-presentation "claude" ;;
  "Antigravity Cloud Login")
    omarchy-launch-floating-terminal-with-presentation "$SCRIPT_DIR/antigravity-waybar-usage-login" ;;
  "Reload Waybar")
    pkill -USR2 waybar ;;
  *)
    exit 0 ;;
esac
