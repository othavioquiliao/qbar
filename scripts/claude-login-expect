#!/usr/bin/env bash
set -euo pipefail

# Automate Claude login: trust folder -> /login -> option 1

if ! command -v expect >/dev/null 2>&1; then
  echo "expect not installed. Installing via yay..."
  yay -S --needed expect
fi

# Launch claude with expect
expect <<'EOF'
set timeout -1
spawn claude

# Trust folder prompt
expect {
  -re "Yes, I trust this folder" {
    send "1\r"
    exp_continue
  }
  -re "Enter to confirm" {
    send "\r"
    exp_continue
  }
  -re "Missing API key" {
    send "/login\r"
    exp_continue
  }
  -re "Select login method" {
    send "1\r"
    exp_continue
  }
  eof
}
EOF
